/* zuck.js - https://github.com/ramon82/zuck.js */
window.ZuckitaDaGalera=window.Zuck=function(u,A){var v=document,d=this;"string"==typeof u&&(u=v.getElementById(u));var g=function(a){return v.querySelectorAll(a)[0]},e=function(a,b){return a?a[b]||"":""},r=function(a,b){if(a)for(var c=a.length,k=0;k<c;k++)b(k,a[k])},B=function(a,b,c){b=[b.toLowerCase(),"webkit"+b,"MS"+b,"o"+b];r(b,function(b,d){a[d]=c})},L=function(a,b,c){c=[c.toLowerCase(),"webkit"+c,"MS"+c,"o"+c];r(c,function(c,d){a.addEventListener(d,b,!1)})},M=function(a,b){L(a,b,"AnimationEnd")},
S=function(a,b){a.transitionEndEvent||(a.transitionEndEvent=!0,L(a,b,"TransitionEnd"))},D=function(a,b){a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b)},N=function(a,b){if(b)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else try{a.requestFullScreen?a.requestFullScreen():a.msRequestFullScreen?a.msRequestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():
a.webkitRequestFullScreen&&a.webkitRequestFullScreen()}catch(c){}},C=function(a,b,c,d){var k=0<b?1:-1;k*=Math.abs(b)/g("#zuck-modal").offsetWidth*90;if(h("cubeEffect")){var f=0==k?"scale(0.95)":"scale(0.930,0.930)";B(g("#zuck-modal-content").style,"Transform",f);if(-90>k||90<k)return!1}b=h("cubeEffect")?"rotateY("+k+"deg)":"translate3d("+b+"px, 0, 0)";a&&(B(a.style,"TransitionTimingFunction",d),B(a.style,"TransitionDuration",c+"ms"),B(a.style,"Transform",b))},E=function(a,b,c,d){var k=0,f=0;if(a){if(a.offsetParent){do if(k+=
a.offsetLeft,f+=a.offsetTop,a==d)break;while(a=a.offsetParent)}b&&(f-=b);c&&(k-=c)}return[k,f]},F=function(a){a=1E3*Number(a);a=new Date(a);var b=a.getTime();b=((new Date).getTime()-b)/1E3;var c=h("language","time");c=[[60," "+c.seconds,1],[120,"1 "+c.minute,""],[3600," "+c.minutes,60],[7200,"1 "+c.hour,""],[86400," "+c.hours,3600],[172800," "+c.yesterday,""],[604800," "+c.days,86400]];var d=1;0>b&&(b=Math.abs(b),d=2);for(var e=0,f;f=c[e++];)if(b<f[0])return"string"==typeof f[2]?f[d]:Math.floor(b/
f[2])+f[1];b=a.getDate();c=a.getMonth();a=a.getFullYear();return b+"/"+(c+1)+"/"+a},l=u.id,G={skin:"snapgram",avatars:!0,stories:[],backButton:!0,backNative:!1,autoFullScreen:!1,openEffect:!0,cubeEffect:!1,list:!1,localStorage:!0,callbacks:{onOpen:function(a,b){b()},onView:function(a){},onEnd:function(a,b){b()},onClose:function(a,b){b()},onNextItem:function(a,b,c){c()}},language:{unmute:"Touch to unmute",keyboardTip:"Press space to see next",visitLink:"Visit link",time:{ago:"ago",hour:"hour ago",
hours:"hours ago",minute:"minute ago",minutes:"minutes ago",fromnow:"from now",seconds:"seconds ago",yesterday:"yesterday",tomorrow:"tomorrow",days:"days ago"}}},h=function(a,b){var c=function(a){return"undefined"!==typeof a};return b?c(A[a])?c(A[a][b])?A[a][b]:G[a][b]:G[a][b]:c(A[a])?A[a]:G[a]},z=new function(){var a=e("#zuck-modal");a||(a=v.createElement("div"),a.id="zuck-modal",h("cubeEffect")&&(a.className="with-cube"),a.innerHTML='<div id="zuck-modal-content"></div>',a.style.display="none",a.setAttribute("tabIndex",
"1"),a.onkeyup=function(a){a=a.keyCode;27==a?z.close():(13==a||32==a)&&z.next()},h("openEffect")&&a.classList.add("with-effects"),S(a,function(){a.classList.contains("closed")&&(b.innerHTML="",a.style.display="none",a.classList.remove("closed"),a.classList.remove("animated"))}),v.body.appendChild(a));var b=g("#zuck-modal-content"),c=function(b){var c="",f="",e="0",O=g("#zuck-modal-slider-"+l),p={previous:g("#zuck-modal .story-viewer.previous"),next:g("#zuck-modal .story-viewer.next"),viewing:g("#zuck-modal .story-viewer.viewing")};
if(!p.previous&&!b||!p.next&&b)return!1;b?(c="next",f="previous"):(c="previous",f="next");h("cubeEffect")?"previous"==c?e=a.slideWidth:"next"==c&&(e=-1*a.slideWidth):(e=E(p[c]),e=-1*e[0]);C(O,e,600,null);setTimeout(function(){if(""!=c&&p[c]&&""!=f){var a=p[c].getAttribute("data-story-id");d.internalData.currentStory=a;(a=g("#zuck-modal .story-viewer."+f))&&a.parentNode.removeChild(a);p.viewing&&(p.viewing.classList.add("stopped"),p.viewing.classList.add(f),p.viewing.classList.remove("viewing"));p[c]&&
(p[c].classList.remove("stopped"),p[c].classList.remove(c),p[c].classList.add("viewing"));(a=H(c))&&k(a,c);a=d.internalData.currentStory;var b=g('#zuck-modal [data-story-id="'+a+'"]');if(b){b=b.querySelectorAll("[data-index].active");var e=b[0].firstElementChild;d.data[a].currentItem=parseInt(b[0].getAttribute("data-index"),10);b[0].innerHTML='<b style="'+e.style.cssText+'"></b>';M(b[0].firstElementChild,function(){d.nextItem(!1)})}C(O,"0",0,null);b&&I([b[0],b[1]],!0);h("callbacks","onView")(d.internalData.currentStory)}},
650)},k=function(a,b,c){var f=g("#zuck-modal-slider-"+l),k="",n="",t=e(a,"id"),q=v.createElement("div"),x=e(a,"currentItem")||0,y="";if(g('#zuck-modal .story-viewer[data-story-id="'+t+'"]'))return!1;q.className="slides";r(e(a,"items"),function(b,c){x>b&&(a.items[b].seen=!0,c.seen=!0);var f=e(c,"length"),d=e(c,"linkText"),g=!0===e(c,"seen")?"seen":"",t='data-index="'+b+'" data-item-id="'+e(c,"id")+'"';x===b&&(y=F(e(c,"time")));n+="<span "+t+' class="'+(x===b?"active":"")+" "+g+'"><b style="animation-duration:'+
(""===f?"3":f)+'s"></b></span>';k+='<div data-time="'+e(c,"time")+'" data-type="'+e(c,"type")+'"'+t+' class="item '+g+" "+(x===b?"active":"")+'">'+("video"===e(c,"type")?'<video class="media" muted webkit-playsinline playsinline preload="auto" src="'+e(c,"src")+'" '+e(c,"type")+'></video><b class="tip muted">'+h("language","unmute")+"</b>":'<img class="media" src="'+e(c,"src")+'" '+e(c,"type")+">")+(e(c,"link")?'<a class="tip link" href="'+e(c,"link")+'" rel="noopener" target="_blank">'+(""==d?h("language",
"visitLink"):d)+"</a>":"")+"</div>"});q.innerHTML=k;var w=q.querySelector("video"),J=function(a){a.muted?m.classList.add("muted"):m.classList.remove("muted")};w&&(w.onwaiting=function(a){w.paused&&(m.classList.add("paused"),m.classList.add("loading"))},w.onplay=function(){J(w);m.classList.remove("stopped");m.classList.remove("paused");m.classList.remove("loading")},w.onready=w.onload=w.onplaying=w.oncanplay=function(){J(w);m.classList.remove("loading")},w.onvolumechange=function(){J(w)});var m=v.createElement("div");
m.className="story-viewer muted "+b+" "+(c?"":"stopped")+" "+(h("backButton")?"with-back-button":"");m.setAttribute("data-story-id",t);c='<div class="head"><div class="left">'+(h("backButton")?'<a class="back">&lsaquo;</a>':"")+'<u class="img" style="background-image:url('+e(a,"photo")+');"></u><div><strong>'+e(a,"name")+'</strong><span class="time">'+y+'</span></div></div><div class="right"><span class="time">'+y+'</span><span class="loading"></span><a class="close" tabIndex="2">&times;</a></div></div><div class="slides-pointers"><div>'+
n+"</div></div>";m.innerHTML=c;r(m.querySelectorAll(".close, .back"),function(a,b){b.onclick=function(a){a.preventDefault();z.close()}});m.appendChild(q);"viewing"==b&&I(m.querySelectorAll('[data-index="'+x+'"].active'),!1);r(m.querySelectorAll(".slides-pointers [data-index] > b"),function(a,b){M(b,function(){d.nextItem(!1)})});"previous"==b?D(f,m):f.appendChild(m)},q=function(b){var k,f,e,h,q,l,r=function(c){var d=g("#zuck-modal .viewing");if("A"==c.target.nodeName)return!0;c.preventDefault();c=
c.touches?c.touches[0]:c;var n=E(g("#zuck-modal .story-viewer.viewing"));a.slideWidth=g("#zuck-modal .story-viewer").offsetWidth;k=n[0];f={x:c.pageX,y:c.pageY,time:Date.now()};e=void 0;h={};b.addEventListener("mousemove",x);b.addEventListener("mouseup",y);b.addEventListener("mouseleave",y);b.addEventListener("touchmove",x);b.addEventListener("touchend",y);d&&d.classList.add("paused");T();q=setTimeout(function(){d.classList.add("longPress")},600);l=setTimeout(function(){clearInterval(l);l=!1},250)},
x=function(a){var c=a.touches?a.touches[0]:a,d=c.pageX;c=c.pageY;f&&(h={x:d-f.x,y:c-f.y},"undefined"===typeof e&&(e=!!(e||Math.abs(h.x)<Math.abs(h.y))),!e&&f&&(a.preventDefault(),C(b,k+h.x,0,null)))},y=function(n){var t=g("#zuck-modal .viewing");if(h){v.querySelectorAll("#zuck-modal .story-viewer");var m=f?Date.now()-f.time:void 0;m=300>Number(m)&&25<Math.abs(h.x)||Math.abs(h.x)>a.slideWidth/3;var p=0>h.x,r=p?g("#zuck-modal .story-viewer.next"):g("#zuck-modal .story-viewer.previous");e||(!m||p&&!r||
!p&&!r?C(b,k,300):c(p,!0));f=void 0;b.removeEventListener("mousemove",x);b.removeEventListener("mouseup",y);b.removeEventListener("mouseleave",y);b.removeEventListener("touchmove",x);b.removeEventListener("touchend",y)}m=d.internalData.currentVideoElement;q&&clearInterval(q);t&&(t.classList.remove("longPress"),t.classList.remove("paused"));if(l)if(clearInterval(l),l=!1,(t=g("#zuck-modal .viewing"))&&m)t.classList.contains("muted")?P(m,t):d.nextItem(n);else return d.nextItem(n),!1};b.addEventListener("touchstart",
r);b.addEventListener("mousedown",r)};return{show:function(c,e){h("callbacks","onOpen")(c,function(){b.innerHTML='<div id="zuck-modal-slider-'+l+'" class="slider"></div>';var e=d.data[c],f=e.currentItem||0,n=g("#zuck-modal-slider-"+l);q(n);d.internalData.currentStory=c;e.currentItem=f;h("backNative")&&(location.hash="#!"+l);(f=H("previous"))&&k(f,"previous");k(e,"viewing",!0);(e=H("next"))&&k(e,"next");h("autoFullScreen")&&a.classList.add("fullscreen");var p=function(){a.classList.contains("fullscreen")&&
h("autoFullScreen")&&1024>=window.screen.width&&N(a);a.focus()};h("openEffect")?(e=g("#"+l+' [data-id="'+c+'"] .img'),f=E(e),a.style.marginLeft=f[0]+e.offsetWidth/2+"px",a.style.marginTop=f[1]+e.offsetHeight/2+"px",a.style.display="block",a.slideWidth=g("#zuck-modal .story-viewer").offsetWidth,setTimeout(function(){a.classList.add("animated")},10),setTimeout(function(){p()},300)):(a.style.display="block",a.slideWidth=g("#zuck-modal .story-viewer").offsetWidth,p());h("callbacks","onView")(c)})},next:function(a){h("callbacks",
"onEnd")(d.internalData.currentStory,function(){var a=d.internalData.currentStory,b=g("#"+l+' [data-id="'+a+'"]');b&&(b.classList.add("seen"),d.data[a].seen=!0,d.internalData.seenItems[a]=!0,Q("seenItems",d.internalData.seenItems),K());g("#zuck-modal .story-viewer.next")?c(!0):z.close()})},close:function(){h("callbacks","onClose")(d.internalData.currentStory,function(){h("backNative")&&(location.hash="");N(a,!0);h("openEffect")?a.classList.add("closed"):(b.innerHTML="",a.style.display="none")})}}},
U=function(a){a=a.getAttribute("data-id");var b=v.querySelectorAll("#"+l+' [data-id="'+a+'"] .items > li'),c=[];r(b,function(a,b){var d=b.firstElementChild,e=d.firstElementChild;c.push({src:d.getAttribute("href"),length:d.getAttribute("data-length"),type:d.getAttribute("data-type"),time:d.getAttribute("data-time"),link:d.getAttribute("data-link"),preview:e.getAttribute("src")})});d.data[a].items=c},R=function(a){var b=a.getAttribute("data-id"),c=!1;d.internalData.seenItems[b]&&(c=!0);c?a.classList.add("seen"):
a.classList.remove("seen");try{d.data[b]={id:b,photo:a.getAttribute("data-photo"),name:a.firstElementChild.lastElementChild.firstChild.innerText,link:a.firstElementChild.getAttribute("href"),lastUpdated:a.getAttribute("data-last-updated"),seen:c,items:[]}}catch(k){d.data[b]={items:[]}}a.onclick=function(a){a.preventDefault();z.show(b)}},H=function(a){var b=d.internalData.currentStory;a+="ElementSibling";return b&&(b=g("#"+l+' [data-id="'+b+'"]')[a])?(b=b.getAttribute("data-id"),d.data[b]||!1):!1},
K=function(){r(v.querySelectorAll("#"+l+" .story.seen"),function(a,b){var c=d.data[b.getAttribute("data-id")];b.parentNode.removeChild(b);d.add(c,!0)})},I=function(a,b){var c=a[1],e=a[0],h=e.parentNode.parentNode.parentNode;if(!c||!e)return!1;var f=d.internalData.currentVideoElement;f&&f.pause();if("video"==c.getAttribute("data-type")){var g=c.getElementsByTagName("video")[0];if(!g)return d.internalData.currentVideoElement=!1;c=function(){g.duration&&B(e.getElementsByTagName("b")[0].style,"AnimationDuration",
g.duration+"s")};c();g.addEventListener("loadedmetadata",c);d.internalData.currentVideoElement=g;g.currentTime=0;g.play();b.target&&P(g,h)}else d.internalData.currentVideoElement=!1},T=function(){var a=d.internalData.currentVideoElement;if(a)try{a.pause()}catch(b){}},P=function(a,b){a.muted=!1;a.volume=1;a.removeAttribute("muted");a.play();a.paused&&(a.muted=!0,a.play());b&&b.classList.remove("paused")},Q=function(a,b){try{h("localStorage")&&(window.localStorage["zuck-"+l+"-"+a]=JSON.stringify(b))}catch(c){}};
d.data={};d.internalData={};d.internalData.seenItems=function(a){return h("localStorage")?(a="zuck-"+l+"-"+a,window.localStorage[a]?JSON.parse(window.localStorage[a]):!1):!1}("seenItems")||{};d.add=d.update=function(a,b){var c=e(a,"id"),k=g("#"+l+' [data-id="'+c+'"]'),q="",f=e(a,"items"),n=!1;d.data[c]={};k?n=k:(n=v.createElement("div"),n.className="story");!1===a.seen&&(d.internalData.seenItems[c]=!1,Q("seenItems",d.internalData.seenItems));n.setAttribute("data-id",c);n.setAttribute("data-photo",
e(a,"photo"));n.setAttribute("data-last-updated",e(a,"lastUpdated"));q=!1;f[0]&&(q=f[0].preview||"");q='<a href="'+e(a,"link")+'"><span class="img"><u style="background-image:url('+(h("avatars")||!q||""==q?e(a,"photo"):q)+')"></u></span><span class="info"><strong>'+e(a,"name")+'</strong><span class="time">'+F(e(a,"lastUpdated"))+'</span></span></a><ul class="items"></ul>';n.innerHTML=q;R(n);k||(b?u.appendChild(n):D(u,n));r(f,function(a,e){d.addItem(c,e,b)});b||K()};d.next=function(){z.next()};d.addItem=
function(a,b,c){a=g("#"+l+' > [data-id="'+a+'"]');var d=v.createElement("li");d.className=e(b,"seen")?"seen":"";d.setAttribute("data-id",e(b,"id"));d.innerHTML='<a href="'+e(b,"src")+'" data-link="'+e(b,"link")+'" data-time="'+e(b,"time")+'" data-type="'+e(b,"type")+'" data-length="'+e(b,"length")+'"><img src="'+e(b,"preview")+'"></a>';b=a.querySelectorAll(".items")[0];c?b.appendChild(d):D(b,d);U(a)};d.removeItem=function(a,b){var c=g("#"+l+' > [data-id="'+a+'"] [data-id="'+b+'"]');u.parentNode.removeChild(c)};
d.nextItem=function(a){var b=d.internalData.currentStory,c=d.data[b].currentItem,e=g('#zuck-modal .story-viewer[data-story-id="'+b+'"]');if(!e||1==e.touchMove)return!1;var l=e.querySelectorAll('[data-index="'+c+'"]'),f=l[0],n=l[1],t=e.querySelectorAll('[data-index="'+(c+1)+'"]'),v=t[0],u=t[1];e&&v&&u?h("callbacks","onNextItem")(b,u.getAttribute("data-story-id"),function(){f.classList.remove("active");f.classList.add("seen");n.classList.remove("active");n.classList.add("seen");v.classList.remove("seen");
v.classList.add("active");u.classList.remove("seen");u.classList.add("active");r(e.querySelectorAll(".time"),function(a,b){b.innerText=F(u.getAttribute("data-time"))});d.data[b].currentItem++;I(t,a)}):e&&z.next(a)};return function(){location.hash=="#!"+l&&(location.hash="");g("#"+l+" .story")&&r(u.querySelectorAll(".story"),function(a,b){R(b,!0)});h("backNative")&&window.addEventListener("popstate",function(a){location.hash!="#!"+l&&(location.hash="")},!1);r(h("stories"),function(a,b){d.add(b,!0)});
K();var a=h("avatars")?"user-icon":"story-preview",b=h("list")?"list":"carousel";u.className="stories "+a+" "+b+" "+(h("skin")+"").toLowerCase();return d}()};
